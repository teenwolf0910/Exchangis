<template>
  <ul
    class="user-menu">
    <li class="user-menu-arrow"/>
    <li
      class="user-menu-item"
      v-for="(menu) in menuList"
      :key="menu.id"
      @click="handleClick(menu.id)">
      <Icon
        class="user-menu-item-icon"
        :type="menu.icon">
      </Icon>
      <span>{{ menu.name }}</span>
    </li>
  </ul>
</template>
<script>
export default {
    FesData: function () {
        return {
          menuList: [
            {
              id: 'changeLang',
              name: localStorage.getItem('lang') === 'en' ? '简体中文' : 'English',
              icon: 'md-repeat',
            },
            {
              id: 'logout',
              name: this.$t('message.common.logOut'),
              icon: 'ios-log-out',
            }
          ],  
        }
    },
    methods: {
      handleClick(type) {
        switch (type) {
          case 'logout':
            this.getRunningJob();
            break;
          case 'changeLang':
            this.languageSwitching();
            break;
        }
      },
      getRunningJob() {
        this.logout();
      },
      languageSwitching() {
        const lang = localStorage.getItem('lang');
        if (lang === 'en') {
            this.FesApp.setLocale('zh-cn')
            localStorage.setItem('lang', 'zh-cn')
        } else {
            this.FesApp.setLocale('en')
            localStorage.setItem('lang', 'en')
        }
        window.location.reload();
      },
      logout(){
        this.FesApp.setRole('unLogin')
        this.FesStorage.set('userLogin', false)
        this.FesApp.set('FesUserName', '');
        this.FesApp.set('FesRoleName', '');
        this.FesStorage.set('currentUser', '');
        this.FesStorage.set('userRole', '');
        this.FesApi.fetch('/logout', {}, 'post').then(() => {
          console.log(`[${this.$t('components.TCCG')}]`);
        }).catch(()=>{
          location.href = "https://www.ctyun.cn/logout"
          // window.Toast(this.$t('components.DCXTSB'));
        })
      }
    }
}
</script>
<style scoped lang="scss">
  @import '../assets/styles/header/headerUserMenu.scss';
</style>